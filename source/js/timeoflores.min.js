/* Time of Lores by Photon Storm. Made with Phaser http://phaser.io */
Phaser.Plugin.TilemapWalker=function(a,b,c,d,e){return this.game=a,this.map=b,this.locationLayer=b.getLayer(c),this.location=new Phaser.Point,this.facing=Phaser.Tilemap.NORTH,this.collides=!0,this.history=[],"undefined"!=typeof d&&"undefined"!=typeof e&&this.setLocation(d,e),this},Phaser.Plugin.TilemapWalker.prototype={setLocation:function(a,b){return this.checkTile(a,b)?(this.location.set(a,b),this.history.push({x:a,y:b}),!0):!1},checkTile:function(a,b){if(this.map.hasTile(a,b,this.locationLayer)){if(this.collides){var c=this.map.getTile(a,b,this.locationLayer);if(c&&c.collides)return!1}return!0}return!1},updateLocation:function(a,b){return this.checkTile(this.location.x+a,this.location.y+b,this.locationLayer)?(this.location.set(this.location.x+a,this.location.y+b),this.history.push({x:a,y:b}),!0):!1},moveForward:function(){return this.facing===Phaser.Tilemap.NORTH?this.updateLocation(0,-1):this.facing===Phaser.Tilemap.EAST?this.updateLocation(1,0):this.facing===Phaser.Tilemap.SOUTH?this.updateLocation(0,1):this.facing===Phaser.Tilemap.WEST?this.updateLocation(-1,0):void 0},moveBackward:function(){return this.facing===Phaser.Tilemap.NORTH?this.updateLocation(0,1):this.facing===Phaser.Tilemap.EAST?this.updateLocation(-1,0):this.facing===Phaser.Tilemap.SOUTH?this.updateLocation(0,-1):this.facing===Phaser.Tilemap.WEST?this.updateLocation(1,0):void 0},moveLeft:function(){return this.facing===Phaser.Tilemap.NORTH?this.updateLocation(-1,0):this.facing===Phaser.Tilemap.EAST?this.updateLocation(0,-1):this.facing===Phaser.Tilemap.SOUTH?this.updateLocation(1,0):this.facing===Phaser.Tilemap.WEST?this.updateLocation(0,1):void 0},moveRight:function(){return this.facing===Phaser.Tilemap.NORTH?this.updateLocation(1,0):this.facing===Phaser.Tilemap.EAST?this.updateLocation(0,1):this.facing===Phaser.Tilemap.SOUTH?this.updateLocation(-1,0):this.facing===Phaser.Tilemap.WEST?this.updateLocation(0,-1):void 0},turnLeft:function(){this.facing--,-1===this.facing&&(this.facing=3)},turnRight:function(){this.facing++,4===this.facing&&(this.facing=0)},putTile:function(a){this.map.putTile(a,this.location.x,this.location.y,this.locationLayer)},getTileFromLocation:function(a,b){return this.map.getTile(this.location.x+a,this.location.y+b,this.locationLayer,!0)},getTile:function(){return this.map.getTile(this.location.x,this.location.y,this.locationLayer,!0)},getTiles:function(a,b,c){var d,d,e,f,g,h,i=Math.floor(a/2),j=Math.floor(b/2);c?(d=this.location.x-i,e=this.location.x+i,g=1,startY=this.location.y-j,f=this.location.y+j,h=1):this.facing===Phaser.Tilemap.NORTH?(d=this.location.x-i,e=this.location.x+i,g=1,startY=this.location.y-(b-1),f=this.location.y,h=1):this.facing===Phaser.Tilemap.EAST?(d=this.location.x,e=this.location.x+(a-1),g=1,startY=this.location.y-j,f=this.location.y+j,h=1):this.facing===Phaser.Tilemap.SOUTH?(d=this.location.x-i,e=this.location.x+i,g=1,startY=this.location.y,f=this.location.y+(b-1),h=1):this.facing===Phaser.Tilemap.WEST&&(d=this.location.x-(a-1),e=this.location.x,g=1,startY=this.location.y-j,f=this.location.y+j,h=1);for(var k=[],l=[],m=startY;f>=m;m+=h){l=[];for(var n=d;e>=n;n+=g){var o=this.map.getTile(n,m,this.locationLayer,!0);l.push(o?o.index:0)}k.push(l)}return this.facing===Phaser.Tilemap.EAST?k=rotateMatrix(k,90):this.facing===Phaser.Tilemap.SOUTH?k=rotateMatrix(k,180):this.facing===Phaser.Tilemap.WEST&&(k=rotateMatrix(k,-90)),k},getMiniMap:function(a,b){var c,c,d,e,f=0,g=Math.floor(a/2),h=Math.floor(b/2);c=this.location.x-g,d=this.location.x+g,startY=this.location.y-h,e=this.location.y+h,0>c&&(d+=Math.abs(c),c=0),d>this.map.width&&(f=d-this.map.width,d=this.map.width,c-=f),0>startY&&(e+=Math.abs(startY),startY=0),e>this.map.height&&(f=e-this.map.height,e=this.map.height,startY-=f);for(var i=[],j=[],k={x:0,y:0},l=startY;e>l;l++){j=[];for(var m=c;d>m;m++){m===this.location.x&&l===this.location.y&&(k.x=j.length,k.y=i.length);var n=this.map.getTile(m,l,this.locationLayer,!0);j.push(n?n.index:0)}i.push(j)}return{walker:k,tiles:i}},getTileAhead:function(a){return"undefined"==typeof a&&(a=1),this.facing===Phaser.Tilemap.NORTH?this.getTileFromLocation(0,-a):this.facing===Phaser.Tilemap.EAST?this.getTileFromLocation(a,0):this.facing===Phaser.Tilemap.SOUTH?this.getTileFromLocation(0,a):this.facing===Phaser.Tilemap.WEST?this.getTileFromLocation(-a,0):void 0},getTileAheadLeft:function(a){return"undefined"==typeof a&&(a=1),this.facing===Phaser.Tilemap.NORTH?this.getTileFromLocation(-a,-a):this.facing===Phaser.Tilemap.EAST?this.getTileFromLocation(a,-a):this.facing===Phaser.Tilemap.SOUTH?this.getTileFromLocation(a,a):this.facing===Phaser.Tilemap.WEST?this.getTileFromLocation(-a,a):void 0},getTileAheadRight:function(a){return"undefined"==typeof a&&(a=1),this.facing===Phaser.Tilemap.NORTH?this.getTileFromLocation(a,-a):this.facing===Phaser.Tilemap.EAST?this.getTileFromLocation(a,a):this.facing===Phaser.Tilemap.SOUTH?this.getTileFromLocation(-a,a):this.facing===Phaser.Tilemap.WEST?this.getTileFromLocation(-a,-a):void 0},getTileBehind:function(a){return"undefined"==typeof a&&(a=1),this.facing===Phaser.Tilemap.NORTH?this.getTileFromLocation(0,a):this.facing===Phaser.Tilemap.EAST?this.getTileFromLocation(-a,0):this.facing===Phaser.Tilemap.SOUTH?this.getTileFromLocation(0,-a):this.facing===Phaser.Tilemap.WEST?this.getTileFromLocation(a,0):void 0},getTileBehindLeft:function(a){return"undefined"==typeof a&&(a=1),this.facing===Phaser.Tilemap.NORTH?this.getTileFromLocation(-a,a):this.facing===Phaser.Tilemap.EAST?this.getTileFromLocation(-a,-a):this.facing===Phaser.Tilemap.SOUTH?this.getTileFromLocation(a,-a):this.facing===Phaser.Tilemap.WEST?this.getTileFromLocation(a,a):void 0},getTileBehindRight:function(a){return"undefined"==typeof a&&(a=1),this.facing===Phaser.Tilemap.NORTH?this.getTileFromLocation(a,a):this.facing===Phaser.Tilemap.EAST?this.getTileFromLocation(-a,a):this.facing===Phaser.Tilemap.SOUTH?this.getTileFromLocation(-a,-a):this.facing===Phaser.Tilemap.WEST?this.getTileFromLocation(a,-a):void 0},getTileLeft:function(a){return"undefined"==typeof a&&(a=1),this.facing===Phaser.Tilemap.NORTH?this.getTileFromLocation(-a,0):this.facing===Phaser.Tilemap.EAST?this.getTileFromLocation(0,-a):this.facing===Phaser.Tilemap.SOUTH?this.getTileFromLocation(a,0):this.facing===Phaser.Tilemap.WEST?this.getTileFromLocation(0,a):void 0},getTileRight:function(a){return"undefined"==typeof a&&(a=1),this.facing===Phaser.Tilemap.NORTH?this.getTileFromLocation(a,0):this.facing===Phaser.Tilemap.EAST?this.getTileFromLocation(0,a):this.facing===Phaser.Tilemap.SOUTH?this.getTileFromLocation(-a,0):this.facing===Phaser.Tilemap.WEST?this.getTileFromLocation(0,-a):void 0}};var rotateMatrix=function(a,b){b=(b%360+360)%360;var c=a,d=function(a){for(var b=new Array(a[0].length),c=0;c<a[0].length;c++){b[c]=new Array(a.length-1);for(var d=a.length-1;d>-1;d--)b[c][d]=a[d][c]}return b},e=function(a){return a.reverse()},f=function(a){for(var b=0;b<a.length;b++)a[b].reverse();return a},g=function(a){return a=d(a),a=e(a)},h=function(a){return a=e(a),a=d(a)},i=function(a){return a=f(a),a=e(a)};return 90==b||-270==b?g(c):-90==b||270==b?h(c):180==Math.abs(b)?i(c):a},pad=function(a,b,c){c="undefined"!=typeof c?c:" ";for(var d=a,e=Math.abs(b);d.length<e;)0>b?d+=c:d=c+d;return d},printMatrix=function(a){for(var b="",c=0;c<a.length;c++){for(var d=0;d<a[c].length;d++){var e=a[c][d].toString();b+="undefined"!=e?pad(e,2):"?",d<a[c].length-1&&(b+=" |")}if(c<a.length-1){b+="\n";for(var f=0;f<a[c].length;f++)b+="---",f<a[c].length-1&&(b+="+");b+="\n"}}return b};TimesOfLores={score:0,music:null,level:1,character:null,cheatInvin:!1,cheatKeys:!1,width:256,height:256,cursors:null,spacebar:null,gamepadLeft:null,gamepadRight:null,gamepadUp:null,gamepadDown:null,gamepadLeftButton:null,gamepadRightButton:null,gamepadA:null,gamepadX:null,pixelCanvas:null,pixelContext:null},TimesOfLores.Boot=function(){},TimesOfLores.Boot.prototype={preload:function(){this.load.image("preloaderBar","images/preload.png")},create:function(){TimesOfLores.pixelCanvas=document.getElementById("pixel"),TimesOfLores.pixelContext=TimesOfLores.pixelCanvas.getContext("2d"),TimesOfLores.width=TimesOfLores.pixelCanvas.width,TimesOfLores.height=TimesOfLores.pixelCanvas.height,Phaser.Canvas.setSmoothingEnabled(TimesOfLores.pixelContext,!1),this.input.maxPointers=1,this.input.gamepad.start(),TimesOfLores.gamepadLeftButton=this.input.gamepad.pad1.addButton(Phaser.Gamepad.XBOX360_LEFT_BUMPER),TimesOfLores.gamepadRightButton=this.input.gamepad.pad1.addButton(Phaser.Gamepad.XBOX360_RIGHT_BUMPER),TimesOfLores.gamepadUp=this.input.gamepad.pad1.addButton(Phaser.Gamepad.XBOX360_DPAD_UP),TimesOfLores.gamepadDown=this.input.gamepad.pad1.addButton(Phaser.Gamepad.XBOX360_DPAD_DOWN),TimesOfLores.gamepadLeft=this.input.gamepad.pad1.addButton(Phaser.Gamepad.XBOX360_DPAD_LEFT),TimesOfLores.gamepadRight=this.input.gamepad.pad1.addButton(Phaser.Gamepad.XBOX360_DPAD_RIGHT),TimesOfLores.gamepadA=this.input.gamepad.pad1.addButton(Phaser.Gamepad.XBOX360_A),TimesOfLores.gamepadX=this.input.gamepad.pad1.addButton(Phaser.Gamepad.XBOX360_X),TimesOfLores.cursors=this.input.keyboard.createCursorKeys(),TimesOfLores.spacebar=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.stage.disableVisibilityChange=!0,this.stage.backgroundColor=4281011742,this.physics.startSystem(Phaser.Physics.ARCADE),window.mapLevel&&(TimesOfLores.level=window.mapLevel,console.log("Level set to",TimesOfLores.level)),"y"===window.mapInvin&&(TimesOfLores.cheatInvin=!0,console.log("Cheat Mode: Invincible")),"y"===window.mapKeys&&(TimesOfLores.cheatKeys=!0,console.log("Cheat Mode: Lock Picker")),this.state.start("Preloader")}};var game;window.onload=function(){game=new Phaser.Game(32,32,Phaser.CANVAS,"game"),game.state.add("Boot",TimesOfLores.Boot),game.state.add("Preloader",TimesOfLores.Preloader),game.state.add("Credits",TimesOfLores.Credits),game.state.add("Help",TimesOfLores.Help),game.state.add("MainMenu",TimesOfLores.MainMenu),game.state.add("CharacterSelect",TimesOfLores.CharacterSelect),game.state.add("Game",TimesOfLores.Game),game.state.add("GameOver",TimesOfLores.GameOver),game.state.add("GameWon",TimesOfLores.GameWon),game.state.add("WellDone",TimesOfLores.WellDone),game.state.start("Boot")},TimesOfLores.Preloader=function(){this.preloadBar=null,this.ready=!1},TimesOfLores.Preloader.prototype={preload:function(){this.preloadBar=this.add.sprite(0,14,"preloaderBar"),this.load.setPreloadSprite(this.preloadBar),this.load.spritesheet("wall0","images/wall0.png",32,32),this.load.spritesheet("wall1","images/wall1.png",32,32),this.load.spritesheet("wall2","images/wall2.png",32,32),this.load.image("wall3","images/wall3.png"),this.load.spritesheet("wall4","images/wall4.png",32,32),this.load.spritesheet("wall5","images/wall5.png",32,32),this.load.image("wall6","images/wall6.png"),this.load.spritesheet("wall7","images/wall7.png",32,32),this.load.spritesheet("wall8","images/wall8.png",32,32),this.load.spritesheet("itemsFar","images/itemsFar.png",32,32),this.load.spritesheet("itemsMid","images/itemsMid.png",32,32),this.load.spritesheet("itemsNear","images/itemsNear.png",32,32),this.load.spritesheet("itemsPickUp","images/itemsPickUp.png",32,32),this.load.spritesheet("nsew","images/nsew.png",5,6),this.load.image("digits","images/digits.png"),this.load.image("help","images/help.png"),this.load.image("intro1","images/intro1.png"),this.load.image("intro2","images/intro2.png"),this.load.image("healthBG","images/health-bg.png"),this.load.image("health","images/health-fill.png"),this.load.image("enemyBG","images/enemy-bg.png"),this.load.image("enemy","images/enemy-fill.png"),this.load.spritesheet("gauge","images/enemy-gauge.png",24,3),this.load.image("attack","images/attack-bar.png"),this.load.image("panel","images/panel.png"),this.load.image("coin","images/coin.png"),this.load.image("photonstorm","images/photonstorm.png"),this.load.image("raster","images/raster.png"),this.load.image("creditsScroller","images/credits.png"),this.load.image("characterSelect1","images/character1.png"),this.load.image("characterSelect2","images/character2.png"),this.load.image("characterSelect3","images/character3.png"),this.load.image("characterSelectLeft","images/select-left.png"),this.load.image("characterSelectRight","images/select-right.png"),this.load.image("title","images/title.png"),this.load.image("title2","images/title2.png"),this.load.image("titlePlay","images/menu-play.png"),this.load.image("titleHelp","images/menu-help.png"),this.load.image("titleCredits","images/menu-credits.png"),this.load.image("wellDone","images/well-done.png"),this.load.image("gameOver","images/gameover.png"),this.load.image("gameWon","images/endgame.png"),this.load.audio("door","audio/door.mp3"),this.load.audio("enemy-dead","audio/enemy-dead.mp3"),this.load.audio("footstep1","audio/footstep1.mp3"),this.load.audio("footstep2","audio/footstep2.mp3"),this.load.audio("footstep3","audio/footstep3.mp3"),this.load.audio("footstep4","audio/footstep4.mp3"),this.load.audio("gameover","audio/gameover.mp3"),this.load.audio("gold","audio/gold.mp3"),this.load.audio("hit","audio/hit.mp3"),this.load.audio("key","audio/key.mp3"),this.load.audio("level-won","audio/level-won.mp3"),this.load.audio("music-intro","audio/music-intro.mp3"),this.load.audio("potion","audio/potion.mp3"),this.load.audio("select","audio/select.mp3"),this.load.audio("whoosh","audio/whoosh.mp3"),this.load.audio("stab","audio/stab.mp3"),this.load.audio("treasure","audio/treasure.mp3"),this.load.audio("armor","audio/armor.mp3"),this.load.audio("credits","audio/credits.mp3"),this.load.audio("fire","audio/fire.mp3"),this.load.audio("Bat","audio/bat.mp3"),this.load.audio("Duck","audio/duck.mp3"),this.load.audio("Frog","audio/frog.mp3"),this.load.audio("Plotop","audio/plotop.mp3"),this.load.audio("Snake","audio/snake.mp3"),this.load.audio("meow","audio/meow.mp3"),window.mapJSON?(console.log("map data loaded from page"),this.load.tilemap("map",null,mapJSON,Phaser.Tilemap.TILED_JSON)):(console.log("map data loaded from file"),this.load.tilemap("map","maps.json",null,Phaser.Tilemap.TILED_JSON))},create:function(){this.preloadBar.cropEnabled=!1},update:function(){this.cache.isSoundDecoded("music-intro")&&this.cache.isSoundDecoded("fire")&&!this.ready&&(this.ready=!0,this.state.start("MainMenu"))},loadRender:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}},TimesOfLores.Credits=function(){this.title,this.tween,this.data,this.rasters,this.scroller,this.pos=[],this.tune},TimesOfLores.Credits.prototype={create:function(){this.stage.backgroundColor="#000000",this.data=this.make.tween({y:-8}).to({y:32},800,Phaser.Easing.Sinusoidal.InOut).yoyo(!0).generateData(60),this.rasters=this.add.group();for(var a=6,b=4,c=0;a>c;c++){var d=this.rasters.create(0,0,"raster");d.alpha=(c+1)*(1/a),this.pos.push(c*b)}this.logo=this.add.image(32,8,"photonstorm"),this.scroller=this.add.image(100,24,"creditsScroller"),TimesOfLores.spacebar.onDown.add(this.backToMenu,this),TimesOfLores.cursors.up.onDown.add(this.backToMenu,this),TimesOfLores.cursors.down.onDown.add(this.backToMenu,this),TimesOfLores.cursors.left.onDown.add(this.backToMenu,this),TimesOfLores.cursors.right.onDown.add(this.backToMenu,this),TimesOfLores.gamepadA.onDown.add(this.backToMenu,this),this.add.tween(this.logo).to({x:-111},3e3,Phaser.Easing.Sinusoidal.InOut,!0,0,1e6,!0),this.add.tween(this.scroller).to({x:-160},1e4,Phaser.Easing.Sinusoidal.InOut,!0,0,1e6),this.tune=this.sound.play("credits",1,!0)},update:function(){this.rasters.resetCursor();for(var a=0;a<this.rasters.total;a++)this.pos[a]++,this.pos[a]===this.data.length&&(this.pos[a]=0),this.rasters.cursor.y=this.data[this.pos[a]].y,this.rasters.next()},backToMenu:function(){this.tune.stop(),this.state.start("MainMenu")},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}},TimesOfLores.Help=function(){this.scroll},TimesOfLores.Help.prototype={create:function(){this.stage.backgroundColor="#000000",this.scroll=this.add.image(0,32,"help"),TimesOfLores.cursors.left.onDown.add(this.backToMenu,this),TimesOfLores.cursors.right.onDown.add(this.backToMenu,this),TimesOfLores.spacebar.onDown.add(this.backToMenu,this),TimesOfLores.gamepadA.onDown.add(this.backToMenu,this),this.add.tween(this.scroll).to({y:0},500,Phaser.Easing.Sinusoidal.InOut,!0)},update:function(){TimesOfLores.cursors.down.isDown&&this.scroll.y>=-132?this.scroll.y-=1:TimesOfLores.cursors.up.isDown&&this.scroll.y<0&&(this.scroll.y+=1)},backToMenu:function(){this.state.start("MainMenu")},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}},TimesOfLores.MainMenu=function(){this.title,this.title2,this.option1,this.option2,this.option3,this.current=1,this.tune,this.tween},TimesOfLores.MainMenu.prototype={create:function(){this.title=this.add.image(0,0,"title"),this.title2=this.add.image(0,0,"title2"),this.title2.alpha=0,this.option1=this.add.image(0,24,"titlePlay"),this.option2=this.add.image(32,24,"titleHelp"),this.option3=this.add.image(-32,24,"titleCredits"),console.log(this.input.gamepad.pad1),TimesOfLores.cursors.up.onDown.add(this.select,this),TimesOfLores.spacebar.onDown.add(this.select,this),TimesOfLores.cursors.left.onDown.add(this.nextOption,this),TimesOfLores.cursors.right.onDown.add(this.prevOption,this),TimesOfLores.gamepadLeft.onDown.add(this.prevOption,this),TimesOfLores.gamepadRight.onDown.add(this.nextOption,this),TimesOfLores.gamepadA.onDown.add(this.select,this),this.current=1,this.startFlicker(),this.sound.play("music-intro"),this.tune=this.sound.play("fire",.3,!0)},startFlicker:function(){var a=this.add.tween(this.title2).to({alpha:1},this.rnd.integerInRange(50,150),Phaser.Easing.Linear.None);a.onComplete.add(this.fadeFlicker,this),a.start()},fadeFlicker:function(){var a=this.add.tween(this.title2).to({alpha:0},this.rnd.integerInRange(50,150),Phaser.Easing.Linear.None);a.onComplete.add(this.startFlicker,this),a.start()},prevOption:function(){this.tween&&this.tween.isRunning||(this.add.tween(this.option1).to({x:"-32"},250,Phaser.Easing.Linear.None,!0),this.add.tween(this.option2).to({x:"-32"},250,Phaser.Easing.Linear.None,!0),this.tween=this.add.tween(this.option3).to({x:"-32"},250,Phaser.Easing.Linear.None,!0),this.tween.onComplete.add(this.reOrder,this),this.sound.play("whoosh"))},nextOption:function(){this.tween&&this.tween.isRunning||(this.add.tween(this.option1).to({x:"+32"},250,Phaser.Easing.Linear.None,!0),this.add.tween(this.option2).to({x:"+32"},250,Phaser.Easing.Linear.None,!0),this.tween=this.add.tween(this.option3).to({x:"+32"},250,Phaser.Easing.Linear.None,!0),this.tween.onComplete.add(this.reOrder,this),this.sound.play("whoosh"))},reOrder:function(){-64===this.option1.x?this.option1.x=32:64===this.option1.x&&(this.option1.x=-32),-64===this.option2.x?this.option2.x=32:64===this.option2.x&&(this.option2.x=-32),-64===this.option3.x?this.option3.x=32:64===this.option3.x&&(this.option3.x=-32),0===this.option1.x?this.current=1:0===this.option2.x?this.current=2:0===this.option3.x&&(this.current=3)},select:function(){this.tune.stop(),this.sound.play("select"),1===this.current?this.state.start("CharacterSelect"):2===this.current?this.state.start("Help"):3===this.current&&this.state.start("Credits")},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}},TimesOfLores.Character=function(a,b){this.game=a.game,this.walker=a.walker,this.type=b,1===this.type?(console.log("Created Character Type 1 (EASY)"),this.baseHitPoints=30,this.initiative=10,this.damageRoll=15,this.damageModifier=7,this.markerSpeed=1e3):2===this.type?(console.log("Created Character Type 2 (MEDIUM)"),this.baseHitPoints=20,this.initiative=5,this.damageRoll=10,this.damageModifier=5,this.markerSpeed=700):3===this.type&&(console.log("Created Character Type 3 (ULTRA)"),this.baseHitPoints=12,this.initiative=5,this.damageRoll=10,this.damageModifier=1,this.markerSpeed=600),this.hitPoints=this.baseHitPoints,this.armorClass=15,this.attackBonus=5,this.keys=0,this.gold=0,this.totalGold=0,this.isFighting=!1,this.yourFightMove=!1},TimesOfLores.Character.prototype={setFullHealth:function(){this.hitPoints=this.baseHitPoints},reset:function(){1===this.type?(this.baseHitPoints=30,this.initiative=10,this.damageRoll=15,this.damageModifier=7):2===this.type?(this.baseHitPoints=20,this.initiative=5,this.damageRoll=10,this.damageModifier=5):3===this.type&&(this.baseHitPoints=12,this.initiative=5,this.damageRoll=10,this.damageModifier=1),this.hitPoints=this.baseHitPoints,this.armorClass=15,this.attackBonus=5,this.keys=0,this.gold=0,this.isFighting=!1,this.yourFightMove=!1}},Object.defineProperty(TimesOfLores.Character.prototype,"health",{get:function(){return this.hitPoints===this.baseHitPoints?10:this.hitPoints/this.baseHitPoints*10}}),Object.defineProperty(TimesOfLores.Character.prototype,"damage",{get:function(){return this.game.rnd.integerInRange(1,this.damageRoll)+this.damageModifier}}),TimesOfLores.CharacterSelect=function(a){this.game=a,this.char1,this.char2,this.char3,this.prev,this.next,this.current=1,this.tween=null,this.cursors},TimesOfLores.CharacterSelect.prototype={create:function(){this.char1=this.add.image(-32,0,"characterSelect1"),this.char2=this.add.image(0,0,"characterSelect2"),this.char3=this.add.image(32,0,"characterSelect3"),this.prev=this.add.image(1,18,"characterSelectLeft"),this.next=this.add.image(28,18,"characterSelectRight"),this.current=2,TimesOfLores.cursors.up.onDown.add(this.startGame,this),TimesOfLores.cursors.down.onDown.add(this.startGame,this),TimesOfLores.spacebar.onDown.add(this.startGame,this),TimesOfLores.cursors.left.onDown.add(this.prevCharacter,this),TimesOfLores.cursors.right.onDown.add(this.nextCharacter,this),TimesOfLores.gamepadLeft.onDown.add(this.prevCharacter,this),TimesOfLores.gamepadRight.onDown.add(this.nextCharacter,this),TimesOfLores.gamepadA.onDown.add(this.startGame,this)},prevCharacter:function(){1===this.current||this.tween&&this.tween.isRunning||(this.current--,this.add.tween(this.char1).to({x:"+32"},250,Phaser.Easing.Linear.None,!0),this.add.tween(this.char2).to({x:"+32"},250,Phaser.Easing.Linear.None,!0),this.tween=this.add.tween(this.char3).to({x:"+32"},250,Phaser.Easing.Linear.None,!0),this.sound.play("whoosh"))},nextCharacter:function(){3===this.current||this.tween&&this.tween.isRunning||(this.current++,this.add.tween(this.char1).to({x:"-32"},250,Phaser.Easing.Linear.None,!0),this.add.tween(this.char2).to({x:"-32"},250,Phaser.Easing.Linear.None,!0),this.tween=this.add.tween(this.char3).to({x:"-32"},250,Phaser.Easing.Linear.None,!0),this.sound.play("whoosh"))},startGame:function(){TimesOfLores.character=new TimesOfLores.Character(this,this.current),console.log("current: ",this.current),this.sound.play("select"),this.state.start("Game")},update:function(){1===this.current?(this.prev.visible=!1,this.next.visible=!0):2===this.current?(this.prev.visible=!0,this.next.visible=!0):3===this.current&&(this.prev.visible=!0,this.next.visible=!1)},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}},TimesOfLores.Enemy=function(a,b){this.game=a.game,this.id=b,this.hitArea=a.hitAreas[b-7],this.baseHitPoints=this.hitPoints},TimesOfLores.Enemy.prototype={wasHit:function(a){return this.hitArea[a]}},Object.defineProperty(TimesOfLores.Enemy.prototype,"health",{get:function(){return this.hitPoints===this.baseHitPoints?10:this.hitPoints<=0?0:Math.round(this.hitPoints/this.baseHitPoints*10)}}),Object.defineProperty(TimesOfLores.Enemy.prototype,"damage",{get:function(){return this.game.rnd.integerInRange(1,this.damageRoll)+this.damageModifier}}),TimesOfLores.Enemy.Bat=function(a,b){this.name="Bat",this.initiative=10,this.hitPoints=10,this.attackBonus=10,this.damageRoll=3,this.damageModifier=0,this.minGold=1,this.maxGold=2,this.armorClass=22,TimesOfLores.Enemy.call(this,a,b)},TimesOfLores.Enemy.Bat.prototype=Object.create(TimesOfLores.Enemy.prototype),TimesOfLores.Enemy.Bat.prototype.constructor=TimesOfLores.Enemy.Bat,TimesOfLores.Enemy.Bat.prototype.kill=function(){return console.log(this.name,"died!"),this.game.rnd.integerInRange(this.minGold,this.maxGold)},TimesOfLores.Enemy.Duck=function(a,b){this.name="Duck",this.initiative=5,this.hitPoints=20,this.attackBonus=5,this.damageRoll=5,this.damageModifier=2,this.minGold=1,this.maxGold=3,this.armorClass=15,TimesOfLores.Enemy.call(this,a,b)},TimesOfLores.Enemy.Duck.prototype=Object.create(TimesOfLores.Enemy.prototype),TimesOfLores.Enemy.Duck.prototype.constructor=TimesOfLores.Enemy.Duck,TimesOfLores.Enemy.Duck.prototype.kill=function(){return console.log(this.name,"died!"),this.game.rnd.integerInRange(this.minGold,this.maxGold)},TimesOfLores.Enemy.Frog=function(a,b){this.name="Frog",this.initiative=0,this.hitPoints=15,this.attackBonus=5,this.damageRoll=5,this.damageModifier=0,this.minGold=1,this.maxGold=1,this.armorClass=12,TimesOfLores.Enemy.call(this,a,b)},TimesOfLores.Enemy.Frog.prototype=Object.create(TimesOfLores.Enemy.prototype),TimesOfLores.Enemy.Frog.prototype.constructor=TimesOfLores.Enemy.Frog,TimesOfLores.Enemy.Frog.prototype.kill=function(){return console.log(this.name,"died!"),this.game.rnd.integerInRange(this.minGold,this.maxGold)},TimesOfLores.Enemy.Plotop=function(a,b){this.name="Plotop",this.initiative=5,this.hitPoints=18,this.attackBonus=6,this.damageRoll=5,this.damageModifier=1,this.minGold=1,this.maxGold=4,this.armorClass=16,TimesOfLores.Enemy.call(this,a,b)},TimesOfLores.Enemy.Plotop.prototype=Object.create(TimesOfLores.Enemy.prototype),TimesOfLores.Enemy.Plotop.prototype.constructor=TimesOfLores.Enemy.Plotop,TimesOfLores.Enemy.Plotop.prototype.kill=function(){return console.log("A Plotop died"),this.game.rnd.integerInRange(this.minGold,this.maxGold)},TimesOfLores.Enemy.Snake=function(a,b){this.name="Snake",this.initiative=0,this.hitPoints=30,this.attackBonus=5,this.damageRoll=6,this.damageModifier=2,this.minGold=1,this.maxGold=5,this.armorClass=21,TimesOfLores.Enemy.call(this,a,b)},TimesOfLores.Enemy.Snake.prototype=Object.create(TimesOfLores.Enemy.prototype),TimesOfLores.Enemy.Snake.prototype.constructor=TimesOfLores.Enemy.Snake,TimesOfLores.Enemy.Snake.prototype.kill=function(){return console.log("A Snake died"),this.game.rnd.integerInRange(this.minGold,this.maxGold)},TimesOfLores.Map=function(a){return Phaser.Group.call(this,a.game),this.walker=a.walker,this.character=a.character,this.sound=a.sound,this.wall0=this.create(0,0,"wall0"),this.wall1=this.create(0,0,"wall1"),this.wall2=this.create(0,0,"wall2"),this.wall3=this.create(0,0,"wall3"),this.itemsFarLeft=this.create(-11,0,"itemsFar",0),this.itemsFarRight=this.create(11,0,"itemsFar",0),this.itemsFar=this.create(0,0,"itemsFar",0),this.wall4=this.create(0,0,"wall4"),this.wall5=this.create(0,0,"wall5"),this.wall6=this.create(0,0,"wall6"),this.itemsMidLeft=this.create(-17,0,"itemsMid",0),this.itemsMidRight=this.create(17,0,"itemsMid",0),this.itemsMid=this.create(0,0,"itemsMid",0),this.wall7=this.create(0,0,"wall7"),this.wall8=this.create(0,0,"wall8"),this.itemsNearLeft=this.create(-16,0,"itemsNear",0),this.itemsNearRight=this.create(16,0,"itemsNear",0),this.itemsNear=this.create(0,0,"itemsNear",0),this.walls=[[this.wall1,this.wall3,this.wall2],[this.wall4,this.wall6,this.wall5],[this.wall7,this.wall0,this.wall8]],this},TimesOfLores.Map.prototype=Object.create(Phaser.Group.prototype),TimesOfLores.Map.prototype.constructor=TimesOfLores.Map,TimesOfLores.Map.prototype.showWall=function(a){a.visible=!0,"wall3"!==a.key&&"wall6"!==a.key&&(a.frame=0===a.frame?1:0)},TimesOfLores.Map.prototype.canPass=function(a){var b=0;return 0===a?b=this.walker.getTileAhead().index:1===a?b=this.walker.getTileLeft().index:2===a?b=this.walker.getTileBehind().index:3===a&&(b=this.walker.getTileRight().index),3!==b&&14!==b?!0:0===a&&(this.character.keys>0||TimesOfLores.cheatKeys)?(this.sound.play("door"),this.character.keys--,this.character.keys<0&&(this.character.keys=0),!0):!1},TimesOfLores.Map.prototype.getStart=function(){this.walker.getMiniMap(16,16)},TimesOfLores.Map.prototype.refresh=function(){this.setAll("visible",!1),this.showWall(this.wall0);var a=this.walker.getTiles(3,3),b=0;for(y=0;3>y;y++)for(x=0;3>x;x++)b=a[y][x],2===b?this.showWall(this.walls[y][x]):3===b?1===x&&0===y?(this.itemsFar.visible=!0,this.itemsFar.frame=0):1===x&&1===y?(this.itemsMid.visible=!0,this.itemsMid.frame=0):this.showWall(this.walls[y][x]):6===b?1===x&&0===y?(this.itemsFar.visible=!0,this.itemsFar.frame=3):1===x&&1===y?(this.itemsMid.visible=!0,this.itemsMid.frame=3):this.showWall(this.walls[y][x]):b>3&&6!==b&&(0===x&&0===y?(this.itemsFarLeft.visible=!0,this.itemsFarLeft.frame=b-3):0===x&&1===y&&(this.itemsMidLeft.visible=!0,this.itemsMidLeft.frame=b-3),1===x&&0===y?(this.itemsFar.visible=!0,this.itemsFar.frame=b-3):1===x&&1===y?(this.itemsMid.visible=!0,this.itemsMid.frame=b-3):1===x&&2===y&&(this.itemsNear.visible=!0,this.itemsNear.frame=b-3),2===x&&0===y?(this.itemsFarRight.visible=!0,this.itemsFarRight.frame=b-3):2===x&&1===y&&(this.itemsMidRight.visible=!0,this.itemsMidRight.frame=b-3))},TimesOfLores.MiniMap=function(a){this.walker=a.walker,this.mapBMD=a.make.bitmapData(32,32),Phaser.Image.call(this,game,0,0,this.mapBMD),this.mapColors=["#000000","#6e6e6e","#4e3d33","#95a8be","#fedd00","#64b732","#4e3d33","#ff3d6a","#ff3d6a","#ff3d6a","#ff3d6a","#ff3d6a","#ff3dff","#6e6e6e","#4bb4ff","#ff8792"],this.mapShadow="#3e281b",this.game.world.add(this),this.visible=!1},TimesOfLores.MiniMap.prototype=Object.create(Phaser.Image.prototype),TimesOfLores.MiniMap.prototype.constructor=TimesOfLores.MiniMap,TimesOfLores.MiniMap.prototype.display=function(){this.mapBMD.fill(110,110,110,1);var a=this.walker.getMiniMap(16,16),b=0,c=0,d=0;for(y=0;16>y;y++){for(x=0;16>x;x++)b=a.tiles[y][x],(b>=0&&2>=b||6===b)&&this.mapBMD.rect(c,d,2,2,this.mapColors[b]),c+=2;c=0,d+=2}for(c=0,d=0,y=0;16>y;y++){for(x=0;16>x;x++)b=a.tiles[y][x],b>2&&13!==b&&6!==b&&(this.mapBMD.rect(c,d,2,3,this.mapShadow),this.mapBMD.rect(c,d,2,2,this.mapColors[b])),c+=2;c=0,d+=2}this.mapBMD.rect(2*a.walker.x,2*a.walker.y,2,3,this.mapShadow),this.mapBMD.rect(2*a.walker.x,2*a.walker.y,2,2,"#ffffff"),this.visible=!0},TimesOfLores.FightScreen=function(a){return Phaser.Group.call(this,a.game),this.state=a,this.ui=a.ui,this.walker=a.walker,this.character=a.character,this.sound=a.sound,this.enemy=null,this.enemyHealthBG=this.create(21,1,"enemyBG"),this.enemyHealthFill=this.create(21,1,"enemy"),this.hitBar=this.create(4,28,"gauge"),this.hitMarker=this.create(4,26,"attack"),this.hitAreas=[],this.hitFont=a.add.retroFont("digits",4,6,"L0123456789-+"),this.hitFont.text="0",this.hitImage=this.create(1,5,this.hitFont),this.hitImage.visible=!1,this.hitTween=a.add.tween(this.hitMarker),this.isFighting=!1,this.yourFightMove=!1,this.visible=!1,this.calculateHitAreas(),this},TimesOfLores.FightScreen.prototype=Object.create(Phaser.Group.prototype),TimesOfLores.FightScreen.prototype.constructor=TimesOfLores.FightScreen,TimesOfLores.FightScreen.prototype.calculateHitAreas=function(){var a=this.game.cache.getImage("gauge").width,b=this.game.cache.getImage("gauge").height,c=this.game.make.bitmapData(a,b);c.draw("gauge"),c.update();for(var d=0;b>d;d+=3){for(var e=[],f=1;a-2>f;f++)e.push(4285152767===c.getPixel32(f,d)?!0:!1);this.hitAreas.push(e)}},TimesOfLores.FightScreen.prototype.display=function(a){switch(this.state.ui.hide(),console.log("FightScreen display",a),a){case 7:this.enemy=new TimesOfLores.Enemy.Frog(this,a);break;case 8:this.enemy=new TimesOfLores.Enemy.Duck(this,a);break;case 9:this.enemy=new TimesOfLores.Enemy.Plotop(this,a);break;case 10:this.enemy=new TimesOfLores.Enemy.Bat(this,a);break;case 11:this.enemy=new TimesOfLores.Enemy.Snake(this,a)
}console.log(this.enemy.hitArea),this.enemyHealthFill.visible=!0,this.hitBar.frame=a-7,this.hitBar.y=-4,this.hitMarker.x=32,this.hitImage.x=1,this.hitImage.y=5,this.hitImage.visible=!1,this.state.add.tween(this.hitBar).to({y:28},1e3,Phaser.Easing.Sinusoidal.Out,!0);var b=this.state.add.tween(this.hitMarker).to({x:4},1e3,Phaser.Easing.Sinusoidal.Out,!0),c=this.d20+this.character.initiative,d=this.d20+this.enemy.initiative;console.log("You are fighting a",this.enemy.name,"with hitpoints:",this.enemy.hitPoints,"and",this.enemy.health,"health"),console.log("Initiative check. You:",c,"Them:",d),this.sound.play(this.enemy.name),c>=d?b.onComplete.add(this.yourAttack,this):b.onComplete.add(this.enemyAttacks,this),this.visible=!0},TimesOfLores.FightScreen.prototype.yourAttack=function(){console.log("You Attack"),this.yourFightMove=!0,this.hitMarker.x=4,this.hitImage.visible=!1,this.hitTween=this.state.add.tween(this.hitMarker).to({x:25},this.character.markerSpeed,Phaser.Easing.Sinusoidal.InOut,!0,0,1e6,!0)},TimesOfLores.FightScreen.prototype.hit=function(){if(this.yourFightMove&&this.hitTween.isRunning){var a=Math.round(this.hitMarker.x)-4;if(console.log("Marker at",a),this.hitTween.stop(),this.hitImage.x=21,this.hitImage.y=7,this.hitImage.visible=!0,this.enemy.wasHit(a)){var b=this.character.damage;console.log("You hit the Enemy for",b,"damage."),this.enemy.hitPoints-=b,this.hitFont.text="-"+b,console.log("Enemy hitPoints:",this.enemy.hitPoints," Health:",this.enemy.health);var c=this.state.add.tween(this.hitImage).to({y:-6},1e3,Phaser.Easing.Sinusoidal.Out);this.state.map.itemsNear.tint=16711680,this.state.time.events.add(150,this.removeTint,this),this.enemy.health>0?(this.sound.play("stab"),c.onComplete.add(this.enemyAttacks,this)):(this.sound.play("enemy-dead"),c.onComplete.add(this.enemyDead,this)),c.start()}else{console.log("You missed"),this.sound.play("armor"),this.hitFont.text="-0";var c=this.state.add.tween(this.hitImage).to({y:-6},1e3,Phaser.Easing.Sinusoidal.Out);c.onComplete.add(this.enemyAttacks,this),c.start()}}},TimesOfLores.FightScreen.prototype.removeTint=function(){this.state.map.itemsNear.tint=16777215},TimesOfLores.FightScreen.prototype.enemyAttacks=function(){console.log("Enemy Attacks"),this.yourFightMove=!1,this.hitImage.x=1,this.hitImage.y=7,this.hitImage.visible=!0;var a=this.d20+this.enemy.attackBonus;if(console.log("Enemy rolls",a,"vs. your armorClass of",this.character.armorClass),a>=this.character.armorClass&&!TimesOfLores.cheatInvin){var b=this.enemy.damage;if(console.log("Enemy hit you for",b,"damage"),this.hitFont.text="-"+b,this.character.hitPoints-=b,console.log("Your hitPoints:",this.character.hitPoints," Health:",this.character.health),this.character.health>0){b>0&&this.ui.splatterHouse(!1);var c=this.state.add.tween(this.hitImage).to({y:-6},1e3,Phaser.Easing.Sinusoidal.Out);c.onComplete.add(this.yourAttack,this)}else{b>0&&this.ui.splatterHouse(!0),console.log("YOU ARE DEAD!");var c=this.state.add.tween(this.hitImage).to({y:-6},1e3,Phaser.Easing.Sinusoidal.Out,!0);this.state.time.events.add(2500,this.gameOver,this)}c.start()}else{console.log("Enemy missed"),this.sound.play("armor"),this.hitFont.text="-0";var c=this.state.add.tween(this.hitImage).to({y:-6},1e3,Phaser.Easing.Sinusoidal.Out);c.onComplete.add(this.yourAttack,this),c.start()}},TimesOfLores.FightScreen.prototype.gameOver=function(){this.state.state.start("GameOver")},TimesOfLores.FightScreen.prototype.enemyDead=function(){console.log("enemy DEAD"),this.enemyHealthFill.visible=!1;var a=this.enemy.kill();this.character.gold+=a,this.character.totalGold+=a,this.character.gold>99&&(this.character.gold-=99),this.state.ui.dropCoins(a),this.walker.putTile(-1),this.state.map.itemsNear.frame=0,console.log("payout",a),this.hide()},TimesOfLores.FightScreen.prototype.hide=function(){this.state.add.tween(this.hitBar).to({y:-4},1e3,Phaser.Easing.Sinusoidal.Out,!0);var a=this.state.add.tween(this.hitMarker).to({x:32},1e3,Phaser.Easing.Sinusoidal.Out,!0);a.onComplete.add(this.hideOver,this)},TimesOfLores.FightScreen.prototype.hideOver=function(){this.isFighting=!1,this.visible=!1,this.state.ui.show()},TimesOfLores.FightScreen.prototype.update=function(){this.enemy&&this.enemyHealthFill.width!==this.enemy.health&&(this.enemyHealthFill.width=this.enemy.health)},Object.defineProperty(TimesOfLores.FightScreen.prototype,"d20",{get:function(){return this.game.rnd.integerInRange(1,20)}}),TimesOfLores.UI=function(a){return Phaser.Group.call(this,a.game),this.state=a,this.walker=a.walker,this.character=a.character,this.sound=a.sound,this.keyFx=this.create(0,0,"itemsPickUp",1),this.potionFx=this.create(0,0,"itemsPickUp",2),this.blingFx=this.create(0,0,"itemsPickUp",12),this.heartFx=this.create(0,0,"itemsPickUp",9),this.bloodSplat=this.create(0,0,"itemsPickUp",0),this.bloodSplat.anchor.set(.5),this.bloodSplat.visible=!1,this.openDoor=this.create(0,0,"itemsPickUp",11),this.openDoor.visible=!1,this.emitter=a.make.emitter(8,0,50),this.emitter.width=20,this.emitter.makeParticles("coin"),this.emitter.minParticleSpeed.set(0,20),this.emitter.maxParticleSpeed.set(0,30),this.emitter.setRotation(0,0),this.add(this.emitter),this.healthBG=this.create(1,1,"healthBG"),this.healthFill=this.create(1,1,"health"),this.nsew=this.create(14,0,"nsew",0),this.levelFont=game.add.retroFont("digits",4,6,"L0123456789-+"),this.levelFont.text="L"+TimesOfLores.level.toString(),this.levelImage=this.create(24,0,this.levelFont),this.panel=this.create(0,25,"panel"),this.keysFont=game.add.retroFont("digits",4,6,"L0123456789-+"),this.keysFont.text=this.character.keys.toString(),this.keysImage=this.create(20,26,this.keysFont),this.goldFont=game.add.retroFont("digits",4,6,"L0123456789-+"),this.goldFont.text=this.character.gold.toString(),this.goldImage=this.create(5,26,this.goldFont),this.keyFx.visible=!1,this.potionFx.visible=!1,this.blingFx.visible=!1,this.heartFx.visible=!1,this.intro1=this.create(0,0,"intro1"),this.intro2=this.create(0,0,"intro2"),this.intro1.visible=!1,this.intro2.visible=!1,this.introTween,this},TimesOfLores.UI.prototype=Object.create(Phaser.Group.prototype),TimesOfLores.UI.prototype.constructor=TimesOfLores.UI,TimesOfLores.UI.prototype.showIntro1=function(){this.intro1.y=32,this.intro1.visible=!0,this.state.add.tween(this.intro1).to({y:0},500,Phaser.Easing.Sinusoidal.InOut,!0)},TimesOfLores.UI.prototype.hideIntro1=function(){this.introTween=this.state.add.tween(this.intro1).to({y:-32},500,Phaser.Easing.Sinusoidal.InOut,!0),this.introTween.onComplete.add(function(){this.intro1.visible=!1},this)},TimesOfLores.UI.prototype.showIntro2=function(){this.intro2.y=32,this.intro2.visible=!0,this.state.add.tween(this.intro2).to({y:0},500,Phaser.Easing.Sinusoidal.InOut,!0)},TimesOfLores.UI.prototype.hideIntro2=function(){this.introTween=this.state.add.tween(this.intro2).to({y:-32},500,Phaser.Easing.Sinusoidal.InOut,!0),this.introTween.onComplete.add(function(){this.intro2.visible=!1},this)},TimesOfLores.UI.prototype.update=function(){this.nsew.frame=this.walker.facing,this.keysFont.text=this.character.keys.toString(),this.goldFont.text=this.character.gold.toString(),this.healthFill.width!==this.character.health&&(this.healthFill.width=this.character.health),this.emitter.update()},TimesOfLores.UI.prototype.dropCoins=function(a){this.emitter.visible=!0,this.emitter.start(!1,2e3,250,a),this.sound.play("gold")},TimesOfLores.UI.prototype.show=function(){this.setAll("visible",!0),this.keyFx.visible=!1,this.potionFx.visible=!1,this.bloodSplat.visible=!1,this.openDoor.visible=!1,this.intro1.visible=!1,this.intro2.visible=!1,this.blingFx.visible=!1,this.heartFx.visible=!1},TimesOfLores.UI.prototype.hide=function(){this.setAll("visible",!1),this.healthBG.visible=!0,this.healthFill.visible=!0},TimesOfLores.UI.prototype.pickUpKey=function(){this.keyFx.x=0,this.keyFx.y=0,this.keyFx.visible=!0,this.walker.putTile(-1),this.state.map.refresh(),this.sound.play("key");var a=this.game.add.tween(this.keyFx).to({y:-32},700,Phaser.Easing.Quartic.In,!0);a.onComplete.add(this.gotKey,this)},TimesOfLores.UI.prototype.pickUpBling=function(){this.blingFx.x=0,this.blingFx.y=0,this.blingFx.visible=!0,this.walker.putTile(-1),this.state.map.refresh(),this.sound.play("treasure"),this.game.add.tween(this.blingFx).to({y:-32},700,Phaser.Easing.Quartic.In,!0),this.emitter.visible=!0,this.emitter.start(!1,2e3,250,1)},TimesOfLores.UI.prototype.pickUpCat=function(){this.heartFx.x=0,this.heartFx.y=32,this.heartFx.visible=!0,this.sound.play("meow"),this.game.add.tween(this.heartFx).to({y:-10},3e3,Phaser.Easing.Back.Out,!0)},TimesOfLores.UI.prototype.gotKey=function(){this.character.keys++,this.character.keys>9&&(this.character.keys=9),this.keyFx.visible=!1},TimesOfLores.UI.prototype.splatterHouse=function(a){this.bloodSplat.x=16,this.bloodSplat.y=8,this.bloodSplat.scale.set(0),this.bloodSplat.alpha=1,this.bloodSplat.visible=!0;var b=900;a&&(b=2e3);var c=this.game.add.tween(this.bloodSplat.scale).to({x:1,y:1},300,Phaser.Easing.Quartic.In),d=this.game.add.tween(this.bloodSplat).to({y:64,alpha:.3},b,Phaser.Easing.Quartic.In);c.chain(d),d.onComplete.add(this.endBlood,this),c.start(),this.sound.play("hit")},TimesOfLores.UI.prototype.endBlood=function(){this.bloodSplat.visible=!1},TimesOfLores.UI.prototype.pickUpPotion=function(){this.potionFx.x=0,this.potionFx.y=0,this.potionFx.visible=!0,this.walker.putTile(-1),this.state.map.refresh(),this.sound.play("potion"),this.game.add.tween(this.healthFill).to({width:10},700,Phaser.Easing.Quartic.In,!0);var a=this.game.add.tween(this.potionFx).to({y:-32},700,Phaser.Easing.Quartic.In,!0);a.onComplete.add(this.gotPotion,this)},TimesOfLores.UI.prototype.gotPotion=function(){this.character.setFullHealth(),this.potionFx.visible=!1},TimesOfLores.Game=function(a){this.game=a,this.levelData,this.walker,this.character,this.map,this.ui,this.minimap,this.fight,this.cursors,this.completed=!1,this._location=new Phaser.Point,this._facing=0},TimesOfLores.Game.prototype={create:function(){this.levelData=this.add.tilemap("map"),this.levelData.setLayer("Level "+TimesOfLores.level),this.levelData.setCollisionByIndex(2);var a=this.levelData.searchTileIndex(13);this.walker=new Phaser.Plugin.TilemapWalker(this.game,this.levelData,this.levelData.currentLayer,a.x,a.y),this._location.copyFrom(this.walker.location),this._facing=this.walker.facing,this.character=TimesOfLores.character,this.map=new TimesOfLores.Map(this),this.ui=new TimesOfLores.UI(this),this.minimap=new TimesOfLores.MiniMap(this),this.fight=new TimesOfLores.FightScreen(this),TimesOfLores.cursors.up.onDown.add(this.moveForward,this),TimesOfLores.cursors.down.onDown.add(this.showMap,this),TimesOfLores.cursors.left.onDown.add(this.turnLeft,this),TimesOfLores.cursors.right.onDown.add(this.turnRight,this),TimesOfLores.gamepadLeftButton.onDown.add(this.turnLeft,this),TimesOfLores.gamepadRightButton.onDown.add(this.turnRight,this),TimesOfLores.gamepadUp.onDown.add(this.moveForward,this),TimesOfLores.gamepadDown.onDown.add(this.moveBackward,this),TimesOfLores.gamepadLeft.onDown.add(this.stepLeft,this),TimesOfLores.gamepadRight.onDown.add(this.stepRight,this),TimesOfLores.gamepadA.onDown.add(this.fight.hit,this.fight),TimesOfLores.gamepadX.onDown.add(this.showMap,this),this.completed=!1,this.ui.openDoor.visible=!1,this.map.refresh(),1===TimesOfLores.level&&this.ui.showIntro2()},moveForward:function(){this.checkKey()&&this.map.canPass(0)&&(14===this.walker.getTileAhead().index?this.openDoor():(this.sound.play("footstep"+this.rnd.integerInRange(1,4)),this.walker.moveForward()))},moveBackward:function(){this.checkKey()&&this.map.canPass(2)&&(this.sound.play("footstep"+this.rnd.integerInRange(1,4)),this.walker.moveBackward())},stepLeft:function(){this.checkKey()&&this.map.canPass(1)&&(this.sound.play("footstep"+this.rnd.integerInRange(1,4)),this.walker.moveLeft())},stepRight:function(){this.checkKey()&&this.map.canPass(3)&&(this.sound.play("footstep"+this.rnd.integerInRange(1,4)),this.walker.moveRight())},turnLeft:function(){this.checkKey()&&(this.sound.play("footstep"+this.rnd.integerInRange(1,4)),this.walker.turnLeft())},turnRight:function(){this.checkKey()&&(this.sound.play("footstep"+this.rnd.integerInRange(1,4)),this.walker.turnRight())},showMap:function(){this.checkKey()&&(this.minimap.display(),this.sound.play("whoosh"))},checkKey:function(){if(!this.ui.introTween||!this.ui.introTween.isRunning){if(this.ui.intro1.visible)return void this.ui.hideIntro1();if(this.ui.intro2.visible)return void this.ui.hideIntro2();if(!this.completed)return this.minimap.visible?(this.minimap.visible=!1,!1):this.fight.visible?(this.fight.yourFightMove&&this.fight.hit(),!1):!0}},checkCurrentTile:function(){var a=this.walker.getTile();a&&(3===a.index||6===a.index?this.walker.putTile(-1):4===a.index?this.ui.pickUpKey():5===a.index?this.character.health<10&&this.ui.pickUpPotion():a.index>=7&&a.index<=11?this.fight.display(a.index):12===a.index?this.gameWon():15===a.index&&(this.character.gold++,this.character.totalGold++,this.character.gold>99&&(this.character.gold-=99),this.ui.pickUpBling()))},openDoor:function(){this.completed=!0,this.ui.openDoor.visible=!0,this.time.events.add(2e3,this.gotoWellDone,this)},gotoWellDone:function(){this.state.start("WellDone")},gameWon:function(){this.completed=!0,this.ui.pickUpCat(),this.time.events.add(2e3,this.gotoGameWon,this)},gotoGameWon:function(){this.state.start("GameWon")},update:function(){this._location.equals(this.walker.location)&&this._facing===this.walker.facing||(this.map.refresh(),this.checkCurrentTile(),this._location.copyFrom(this.walker.location),this._facing=this.walker.facing)},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}},TimesOfLores.GameOver=function(a){this.game=a},TimesOfLores.GameOver.prototype={create:function(){this.add.image(0,0,"gameOver"),TimesOfLores.cursors.up.onDown.add(this.backToMenu,this),TimesOfLores.cursors.down.onDown.add(this.backToMenu,this),TimesOfLores.spacebar.onDown.add(this.backToMenu,this),TimesOfLores.gamepadA.onDown.add(this.backToMenu,this),this.sound.play("gameover")},backToMenu:function(){TimesOfLores.level=1,TimesOfLores.character.reset(),this.state.start("MainMenu")},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}},TimesOfLores.GameWon=function(a){this.game=a},TimesOfLores.GameWon.prototype={create:function(){this.add.image(0,0,"gameWon"),TimesOfLores.cursors.up.onDown.add(this.backToMenu,this),TimesOfLores.cursors.down.onDown.add(this.backToMenu,this),TimesOfLores.spacebar.onDown.add(this.backToMenu,this),TimesOfLores.gamepadA.onDown.add(this.backToMenu,this),this.sound.play("level-won")},backToMenu:function(){TimesOfLores.level=1,TimesOfLores.character.reset(),this.state.start("MainMenu")},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}},TimesOfLores.WellDone=function(a){this.game=a,this.cursors},TimesOfLores.WellDone.prototype={create:function(){this.add.image(0,8,"wellDone"),TimesOfLores.cursors.up.onDown.add(this.nextLevel,this),TimesOfLores.cursors.down.onDown.add(this.nextLevel,this),TimesOfLores.spacebar.onDown.add(this.nextLevel,this),TimesOfLores.gamepadA.onDown.add(this.nextLevel,this),this.sound.play("level-won")},nextLevel:function(){TimesOfLores.level++,this.state.start("Game")},render:function(){TimesOfLores.pixelContext.drawImage(game.canvas,0,0,32,32,0,0,TimesOfLores.width,TimesOfLores.height)}};